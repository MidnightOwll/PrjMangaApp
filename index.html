<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>MangaApp</title>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css">
        <link rel="stylesheet" href="./styles.css">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.7.7/handlebars.min.js"></script>
    </head>

  <body class="bg-dark m-3">  
    <!--    Шапка сайта    -->
    <header>        
        <div class="fixed-top bg-dark border-bottom scrll"> 

            <div class="container navigation"> 
                <h1 id="brandName">MangaApp</h1>
                <span class="buttonBase">Categories</span>
            </div>
            
                                
                       
            <div class="container menubar" >

                <form role="search" class="form-inline" action="" method="">
                    <input class="form-control mr-sm-2 bg-light" type="search" placeholder="Search" aria-label="Search" id="searchLab">
                    <button class="btn btn-light my-2 my-sm-0" type="submit">Search</button>
                </form>

                <div class="menubar-btn btn-group">
                    <button type="button" class="btn" data-bs-toggle="dropdown" id="menu-btn" aria-expanded="false">
                        <span class="buttonBase">something</span>
                    </button>
                    <ul class="dropdown-menu bg-dark text-white" id="listM" aria-labelledby="menu-btn"> </ul> 
                </div>

				<ul class="menu">
                    <div  id="menubarList">
                        <li class=""> <span class="buttonBase">something</span></li>	
                        <li class="selected"><span class="buttonBase">something</span></li>
                        <li class="dropdown">
                            <span id="drop1" href="#" class="buttonBase" data-toggle="dropdown">
                                something
                                <span class="caret"></span>
                            </span>
                            <ul class="dropdown-menu bg-dark">
                                <li><span class="buttonBase">something</span></li>
                                <li><span class="buttonBase">something</span></li>
                                <li><span class="buttonBase">something</span></li>
                            </ul>
                        </li>
                    </div>
				</ul>

			</div>
                          
        </div>
                
    </header>
        <!--    Основной контент     -->
    <div class="container" >
        <div class="row" id="main_content"></div>
        <div class="d-flex justify-content-center">
            <div class="spinner-border text-secondary text-center" role="status">
            
            </div>
        </div>
              

        

        <!-- <div class="row text-muted">

            <div class="col-lg-4 manga-block">
                <div class="row border">
                    <div class="col-6">
                        <img class="manga-img" id="img">
                    </div>
                   
                    <div class="col-6 flex">
                        <div class="manga-box">
                            <span class="title-text"  id="title"> FDJS sasdasdasdasd sdfsd sdcdscs sdasdasddfsdlkfn sdgs</span>
                        </div>
                        <div class="manga-box">
                            <span>Author: </span><span id="author">FDJS sasdasdasdasd sdasdasddfsdlkfn sdgs</span>                            
                        </div>
                        <div class="manga-box">
                            <span>Teg: </span> <div id="tegs"><span>1111</span><span>2222</span><span>3333</span></div>                            
                        </div>
                        <div class="manga-box flex-grow">
                            <span>Description:</span><span id="description">Sed libero, odio. Justo quis, dui sodales mauris arcu sodales malesuada amet sed malesuada aenean sapien in consectetur cursus quis, ex. Amet, lacinia mollis sed libero, ornare mattis sodales amet venenatis molestie augue nulla et dictumst. Lectus quam, molestie morbi amet risus venenatis nunc malesuada et luctus cras hac libero, cursus habitasse ornare vulputate vitae amet, vel nunc accumsan id adipiscing sit odio. In ornare aenean mattis dui eleifend velit mollis pellentesque nulla sit id consectetur vitae libero, ut. Imperdiet integer interdum nunc cursus tempus risus et. Imperdiet et sodales imperdiet lacinia sed imperdiet cursus dictum. Orci, ultricies. Justo dictumst. Cras urna quis, et. Cursus morbi arcu adipiscing mollis id sit lorem sit consectetur cursus in vestibulum accumsan venenatis est. Molestie orci, ut. Ornare malesuada hac cras habitasse sit dui morbi molestie in consectetur lorem dolor ultricies. Malesuada imperdiet quis, ex. Eleifend dolor faucibus. Dui dui cras cras dictum odio. Aenean ipsum dictum justo ex. Amet, velit lacinia mattis venenatis integer amet, platea nec pulvinar et ornare in non mattis habitasse ipsum et. Ultricies. Ornare ipsum faucibus. Imperdiet mattis non sodales vulputate sit faucibus. Mauris mauris venenatis dui integer eleifend tempus arcu quis, tempus non arcu risus consectetur sapien dolor non dictum accumsan risus vitae dolor efficitur in dictum. Eget mattis non aenean interdum mauris cras sed et sapien mattis ipsum id odio. Quis, non in non ut. Elit. Mauris molestie sit pulvinar et tempus integer mauris dictum. Sapien habitasse cras id lorem venenatis id imperdiet nec morbi orci, mauris adipiscing platea ipsum sit est. Odio. Non pulvinar elit. Integer vitae tortor, ornare imperdiet sit habitasse nec pulvinar arcu dictumst. Pellentesque nisi venenatis faucibus. Non non interdum amet, accumsan lectus mattis vitae mauris sapien libero, sapien dictum. Dui non platea dictum non in non nunc et ornare integer pulvinar consectetu.</span>                            
                        </div>                        
                    </div>	
                </div>                
            </div>

            <div class="col-lg-4 manga-block">
                <div class="row border">
                    <div class="col-6">
                        <img class="manga-img" id="img">
                    </div>
                   
                    <div class="col-6 flex">
                        <div class="manga-box">
                            <span class="title-text"  id="title"> FDJS sasdasdasdasd sdfsd sdcdscs sdasdasddfsdlkfn sdgs</span>
                        </div>
                        <div class="manga-box">
                            <span>Author: </span><span id="author">FDJS sasdasdasdasd sdasdasddfsdlkfn sdgs</span>                            
                        </div>
                        <div class="manga-box">
                            <span>Teg: </span> <div id="tegs"><span>1111</span><span>2222</span><span>3333</span></div>                            
                        </div>
                        <div class="manga-box flex-grow">
                            <span>Description:</span><span id="description">Sed libero, odio. Justo quis, dui sodales mauris arcu sodales malesuada amet sed malesuada aenean sapien in consectetur cursus quis, ex. Amet, lacinia mollis sed libero, ornare mattis sodales amet venenatis molestie augue nulla et dictumst. Lectus quam, molestie morbi amet risus venenatis nunc malesuada et luctus cras hac libero, cursus habitasse ornare vulputate vitae amet, vel nunc accumsan id adipiscing sit odio. In ornare aenean mattis dui eleifend velit mollis pellentesque nulla sit id consectetur vitae libero, ut. Imperdiet integer interdum nunc cursus tempus risus et. Imperdiet et sodales imperdiet lacinia sed imperdiet cursus dictum. Orci, ultricies. Justo dictumst. Cras urna quis, et. Cursus morbi arcu adipiscing mollis id sit lorem sit consectetur cursus in vestibulum accumsan venenatis est. Molestie orci, ut. Ornare malesuada hac cras habitasse sit dui morbi molestie in consectetur lorem dolor ultricies. Malesuada imperdiet quis, ex. Eleifend dolor faucibus. Dui dui cras cras dictum odio. Aenean ipsum dictum justo ex. Amet, velit lacinia mattis venenatis integer amet, platea nec pulvinar et ornare in non mattis habitasse ipsum et. Ultricies. Ornare ipsum faucibus. Imperdiet mattis non sodales vulputate sit faucibus. Mauris mauris venenatis dui integer eleifend tempus arcu quis, tempus non arcu risus consectetur sapien dolor non dictum accumsan risus vitae dolor efficitur in dictum. Eget mattis non aenean interdum mauris cras sed et sapien mattis ipsum id odio. Quis, non in non ut. Elit. Mauris molestie sit pulvinar et tempus integer mauris dictum. Sapien habitasse cras id lorem venenatis id imperdiet nec morbi orci, mauris adipiscing platea ipsum sit est. Odio. Non pulvinar elit. Integer vitae tortor, ornare imperdiet sit habitasse nec pulvinar arcu dictumst. Pellentesque nisi venenatis faucibus. Non non interdum amet, accumsan lectus mattis vitae mauris sapien libero, sapien dictum. Dui non platea dictum non in non nunc et ornare integer pulvinar consectetu.</span>                            
                        </div>                        
                    </div>	
                </div>                
            </div>

            <div class="col-lg-4 manga-block">
                <div class="row border">
                    <div class="col-6">
                        <img class="manga-img" id="img">
                    </div>
                   
                    <div class="col-6 flex">
                        <div class="manga-box">
                            <span class="title-text"  id="title"> FDJS sasdasdasdasd sdfsd sdcdscs sdasdasddfsdlkfn sdgs</span>
                        </div>
                        <div class="manga-box">
                            <span>Author: </span><span id="author">FDJS sasdasdasdasd sdasdasddfsdlkfn sdgs</span>                            
                        </div>
                        <div class="manga-box">
                            <span>Teg: </span> <div id="tegs"><span>1111</span><span>2222</span><span>3333</span></div>                            
                        </div>
                        <div class="manga-box flex-grow">
                            <span>Description:</span><span id="description">Sed libero, odio. Justo quis, dui sodales mauris arcu sodales malesuada amet sed malesuada aenean sapien in consectetur cursus quis, ex. Amet, lacinia mollis sed libero, ornare mattis sodales amet venenatis molestie augue nulla et dictumst. Lectus quam, molestie morbi amet risus venenatis nunc malesuada et luctus cras hac libero, cursus habitasse ornare vulputate vitae amet, vel nunc accumsan id adipiscing sit odio. In ornare aenean mattis dui eleifend velit mollis pellentesque nulla sit id consectetur vitae libero, ut. Imperdiet integer interdum nunc cursus tempus risus et. Imperdiet et sodales imperdiet lacinia sed imperdiet cursus dictum. Orci, ultricies. Justo dictumst. Cras urna quis, et. Cursus morbi arcu adipiscing mollis id sit lorem sit consectetur cursus in vestibulum accumsan venenatis est. Molestie orci, ut. Ornare malesuada hac cras habitasse sit dui morbi molestie in consectetur lorem dolor ultricies. Malesuada imperdiet quis, ex. Eleifend dolor faucibus. Dui dui cras cras dictum odio. Aenean ipsum dictum justo ex. Amet, velit lacinia mattis venenatis integer amet, platea nec pulvinar et ornare in non mattis habitasse ipsum et. Ultricies. Ornare ipsum faucibus. Imperdiet mattis non sodales vulputate sit faucibus. Mauris mauris venenatis dui integer eleifend tempus arcu quis, tempus non arcu risus consectetur sapien dolor non dictum accumsan risus vitae dolor efficitur in dictum. Eget mattis non aenean interdum mauris cras sed et sapien mattis ipsum id odio. Quis, non in non ut. Elit. Mauris molestie sit pulvinar et tempus integer mauris dictum. Sapien habitasse cras id lorem venenatis id imperdiet nec morbi orci, mauris adipiscing platea ipsum sit est. Odio. Non pulvinar elit. Integer vitae tortor, ornare imperdiet sit habitasse nec pulvinar arcu dictumst. Pellentesque nisi venenatis faucibus. Non non interdum amet, accumsan lectus mattis vitae mauris sapien libero, sapien dictum. Dui non platea dictum non in non nunc et ornare integer pulvinar consectetu.</span>                            
                        </div>                        
                    </div>	
                </div>                
            </div>

           

          
                     
        </div> -->

        
    </div>

    <footer>
    	<div class="container fixed-bottom">
    		<p class="text-center"><a href="#">MangaApp</a></p>
    	</div>
    </footer>
  
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script src= './render.js'></script>   
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
    <script src= './getManga.js'></script>
    <script id = 'currentManga' type="text/template">
        <div class="col-lg-4 manga-block text-muted">
            <div class="row border">
                <div class="col-6">
                    <img class="manga-img" id="img" src= {{ coverLink }}>
                </div>
               
                <div class="col-6 flex">
                    <div class="manga-box">
                        <span class="title-text"  id="title"> {{title}} </span>
                    </div>
                    <div class="manga-box">
                        <span>Author: </span><span id="author">{{author}}</span>                            
                    </div>
                    <div class="manga-box">
                        <span>Teg: </span> <div id="tegs"><span>1111</span><span>2222</span><span>3333</span></div>                            
                    </div>
                    <div class="manga-box flex-grow">
                        <span>Description:</span><span id="description">{{description}}</span>                            
                    </div>                        
                </div>	
            </div>                
        </div>
    </script>   
    
    <script>
        
        let mangaList = new MangaList();
        let main_cont = document.getElementById('main_content');
        let currentManga = document.querySelector('#currentManga').innerHTML
        let template = Handlebars.compile(currentManga);
        // в качестве параметра функции выступает массив, 
        // ключем и значениями которого выступают параметры для запроса на АПИ
       // console.log(mangaList.getMangaList({'limit':15}))
        

       mangaList.getMangaList({'limit':15}).then(list => {
            $.each(list, (num, rez) => {
                    //console.log(rez)
                    //console.log(mangaList.getAuthor(rez.relationships[0].id) )
                    // let oneManga = mangaList.mangaListProcess(rez).then(oneManga => {
                    //     console.log(oneManga)
                    //     let result = template(oneManga)
                    //     main_cont.insertAdjacentHTML('afterend', result)
                    // })    
                    
                  
                    const oneManga = mangaList.mangaListProcess(rez)
                    console.log(oneManga)
                    setTimeout(() =>{
                        let result = template(oneManga)
                        $('#main_content').append(result)
                        // main_cont.insertAdjacentHTML('afterend', result)
                    }
                    ,3000)
                    // .then((manga) => {
                    //     console.log(manga)
                    //     let result = template(manga)
                    //     main_cont.insertAdjacentHTML('afterend', result)
                    // })
                   
                   
                    // .then(manga => {
                    //     console.log(manga)
                    //     let result = template(manga)
                    //     main_cont.insertAdjacentHTML('afterend', result)
                    // })              
                    
                                       

                    //console.log(result)
                    //main_cont.append($.parseHTML(result))
                    //result = $.parseHTML(result)
            })
        })
      // console.log(list)
        
        // }).fail(function(jqXHR, textStatus, errorThrown){
        //     alert("The AJAX request failed:" + errorThrown);
        // });

        /*
        $.get( 'https://api.mangadex.org/manga?limit=20', (mangaList) => {
                    //console.log(mangaList)
                    const titleList = mangaList.results
                   // console.log(titleList)
                   let manga = []
                   // извлечение данных
                   $.each(titleList, (num, rez) => {
                       //console.log(num, rez)
                       manga[num] = {}
                       $.each(rez, (key, val) => {
                           //console.log(key , val)                      
                       
                            if (key === 'data') {
                                
                                    $.extend(manga[num], {id: val.id})
                                    $.extend(manga[num], {title: val.attributes.title.en})
                                    $.extend(manga[num], {description: val.attributes.description.en})                                                    
                                
                            } else if (key === 'relationships') {                            
                                    $.each(val, (idx, value) => {
                                        if(value['type']  === 'author') {
                                            $.extend(manga[num], {authorId: value.id}) 
                                        } else if(value['type']  === 'cover_art'){
                                            $.extend(manga[num], {coverId: value.id})
                                        }
                                        //ХЗ где взять теги...
                                    })        
                                    
                                   
                                    
                                }
                       
                       
                        })
                        
                        console.log(manga[num])
                    })
                    // работа с данными
                    $('#title').text(manga[0].title)
                    $.get( `https://api.mangadex.org/author/${manga[0].authorId}`, (authorList) => {
                        //console.log(authorList)
                        $('#author').text(authorList.data.attributes.name)
                    })
                    $.get(`https://api.mangadex.org/cover/${manga[0].coverId}`, (coverList) => {
                        $('#img').attr('src', `https://uploads.mangadex.org/covers/${manga[0].id}/${coverList.data.attributes.fileName}`)
                    })
                   
                   
                },
                "json"
            )
            
            
           /* setTimeout(()=>{
                const titleList =  mangaList.responseJSON['results']//[0]['data']['attributes']['altTitles'][5]['en']
                let mangaIds = []
                let mangaCoverArtIds = []
                let mangaArtImgs = []
                $.each(titleList, (key,value) => {
                   // console.log(value['data']['attributes']['title']['en'])
                     mangaIds.push(value['data']['id'])
                    //const mangaCoverArtId = value['relationships']['2']['id']
                    
                    $.each(value['relationships'], (key2, value2) => {
                        if(value2['type']  === 'cover_art'){
                            mangaCoverArtIds.push(value2['id'])
                            const coverList =  $.get(`https://api.mangadex.org/cover/${value2['id']}`, () => {},"json")
                            setTimeout(()=>{                        
                                mangaArtImgs.push(coverList.responseJSON['data']['attributes']['fileName'])
                                //console.log(mangaArtImgs)
                            }, 500)
                        }                            
                    })               
                    
                })
                //console.log(mangaIds[0], mangaArtImgs[0])
                console.log( mangaArtImgs)
                setTimeout(()=>{
                 $('.manga-img').attr('src', `https://uploads.mangadex.org/covers/${mangaIds[0]}/${mangaArtImgs[0]}`)
                }, 600)
            }, 1000)

 */           
            // меню
            $('#menubarList').clone().appendTo('#listM')
                      
            // отображение поисковой формы 
            $('#searchLab').focus(() => {
                $('.navigation').css('display', 'none')
                $('.menubar-btn').css('display', 'none')
                $('.menu').css('display', 'none')
                $('.menubar').css({
                    'width': '100%',
                    'padding': '0 10% 0 10%'
                }).removeClass('container')
                $('.form-inline').css('width', '100%')
                $('#searchLab').css('width','85%')
            })

            $('#searchLab').focusout(() => {
                $('.navigation').css('display', '')
                $('.menubar-btn').css('display', '')
                $('.menu').css('display', '')
                $('.menubar').css({
                    'width': '',
                    'padding': ''
                }).addClass('container')
                $('.form-inline').css('width', '')
                $('#searchLab').css('width','')
            })

                       
            // Scroll для основного меню
            const $scrll = $(".scrll")
            let prevScroll
            let lastShowPos

            $(window).on("scroll", () => {
            const scrolled = $(window).scrollTop()

                if (scrolled > 100 && scrolled > prevScroll) {
                    $scrll.addClass("menu-out")
                    lastShowPos = scrolled
                } else if (scrolled <= Math.max(lastShowPos - 150, 0)) {
                    $scrll.removeClass("menu-out")
                }
                prevScroll = scrolled
            })

                       

         </script>
   </body>
</html>